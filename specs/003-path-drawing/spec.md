# Feature Specification: Path Drawing System

**Feature Branch**: `003-path-drawing`
**Created**: 2025-01-14
**Status**: Draft
**Input**: 플레이어가 비행기 경로를 그리는 경로 드로잉 시스템

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 비행기 선택 및 경로 그리기 (Priority: P1)

플레이어가 비행기를 탭/클릭하여 선택한 후, 드래그하여 활주로까지 경로를 그릴 수 있다.

**Why this priority**: 게임의 핵심 상호작용. 이 기능 없이는 게임을 플레이할 수 없음.

**Independent Test**: 비행기 선택 후 드래그하면 화면에 경로가 표시되는지 확인

**Acceptance Scenarios**:

1. **Given** 비행기가 화면에 있을 때, **When** 플레이어가 비행기를 탭/클릭하면, **Then** 비행기가 선택된 상태로 표시된다
2. **Given** 비행기가 선택된 상태에서, **When** 플레이어가 드래그하면, **Then** 드래그 궤적을 따라 경로가 화면에 표시된다
3. **Given** 경로를 그리는 중에, **When** 플레이어가 손/마우스를 놓으면, **Then** 경로가 확정되고 비행기가 해당 경로를 따라 이동하기 시작한다

---

### User Story 2 - 경로 시각화 (Priority: P2)

플레이어가 그린 경로가 화면에 명확하게 표시되어 비행기가 어디로 갈지 미리 알 수 있다.

**Why this priority**: 플레이어가 전략을 세우기 위해 필수적인 시각적 피드백

**Independent Test**: 경로가 그려질 때 점선이나 선으로 명확히 표시되는지 확인

**Acceptance Scenarios**:

1. **Given** 플레이어가 경로를 그리고 있을 때, **When** 드래그 중이면, **Then** 실시간으로 경로가 화면에 표시된다
2. **Given** 경로가 확정된 후, **When** 비행기가 이동 중이면, **Then** 남은 경로가 시각적으로 표시된다
3. **Given** 비행기가 경로를 따라 이동할 때, **When** 경로 구간을 지나면, **Then** 지나간 경로는 사라지거나 흐려진다

---

### User Story 3 - 경로 수정 (Priority: P3)

플레이어가 이미 설정된 경로를 가진 비행기를 다시 선택하여 새로운 경로로 수정할 수 있다.

**Why this priority**: 실수 수정 및 전략 변경 가능성 제공

**Independent Test**: 기존 경로가 있는 비행기를 다시 선택하여 새 경로를 그릴 수 있는지 확인

**Acceptance Scenarios**:

1. **Given** 이미 경로가 설정된 비행기가 있을 때, **When** 플레이어가 해당 비행기를 다시 선택하면, **Then** 새로운 경로를 그릴 수 있는 상태가 된다
2. **Given** 새로운 경로를 그리는 중에, **When** 새 경로가 확정되면, **Then** 이전 경로는 완전히 교체된다
3. **Given** 비행기가 이동 중일 때, **When** 새 경로가 설정되면, **Then** 현재 위치에서부터 새 경로를 따라 이동한다

---

### User Story 4 - 활주로 자동 연결 (Priority: P4)

플레이어가 경로를 활주로 근처에서 놓으면 자동으로 활주로까지 연결된다.

**Why this priority**: 사용자 편의성 향상

**Independent Test**: 활주로 근처에서 드래그를 놓으면 경로가 자동으로 활주로까지 연결되는지 확인

**Acceptance Scenarios**:

1. **Given** 플레이어가 경로를 그리고 있을 때, **When** 활주로 근처(일정 반경 내)에서 손을 놓으면, **Then** 경로가 자동으로 활주로 중심까지 연결된다
2. **Given** 헬기의 경로를 그릴 때, **When** 헬기패드 근처에서 놓으면, **Then** 헬기패드까지 자동 연결된다

---

### Edge Cases

- 화면 밖으로 드래그가 나가면 어떻게 되는가?
- 매우 짧은 경로(거의 점에 가까운)를 그리면 어떻게 처리하는가?
- 경로가 다른 비행기를 통과하도록 그려지면 어떻게 되는가?
- 동시에 여러 비행기를 선택하려고 하면 어떻게 되는가?

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 플레이어는 비행기를 탭/클릭하여 선택할 수 있어야 한다
- **FR-002**: 선택된 비행기에서 드래그하면 경로가 생성되어야 한다
- **FR-003**: 경로는 화면에 시각적으로 표시되어야 한다 (점선 또는 실선)
- **FR-004**: 경로는 부드러운 곡선으로 표시되어야 한다 (급격한 꺾임 보정)
- **FR-005**: 활주로 근처에서 드래그를 놓으면 자동으로 활주로까지 연결되어야 한다
- **FR-006**: 이미 경로가 있는 비행기를 다시 선택하면 새 경로로 교체할 수 있어야 한다
- **FR-007**: 마우스와 터치 입력 모두 동일하게 동작해야 한다
- **FR-008**: 비행기가 이동하면서 지나간 경로 부분은 사라져야 한다

### Key Entities

- **PathPoint**: 경로상의 단일 지점 (위치 좌표)
- **Path**: 경로 전체 (포인트 목록, 부드러운 곡선 정보, 총 길이)
- **DrawingState**: 현재 드로잉 상태 (IDLE, SELECTING, DRAWING)
- **SelectedAircraft**: 현재 선택된 비행기 참조

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 플레이어가 비행기를 탭한 후 0.1초 이내에 선택 피드백이 표시된다
- **SC-002**: 드래그하는 동안 경로가 실시간으로 (지연 없이) 화면에 그려진다
- **SC-003**: 경로의 급격한 꺾임이 자연스러운 곡선으로 보정되어 시각적으로 부드럽다
- **SC-004**: 활주로 반경 50px 이내에서 드래그를 놓으면 100% 자동 연결된다
- **SC-005**: 터치와 마우스 입력이 동일한 결과를 낸다

## Assumptions

- 한 번에 하나의 비행기만 선택 가능 (멀티 선택 미지원)
- 경로의 최소 길이는 50px로 제한 (너무 짧은 경로 방지)
- 경로 스무딩은 카트뮬-롬 스플라인 또는 베지어 곡선 기반 (시각적 부드러움)
- 활주로 자동 연결 반경은 50px
