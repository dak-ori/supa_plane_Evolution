# Feature Specification: Collision & Score System

**Feature Branch**: `004-collision-score`
**Created**: 2025-01-14
**Status**: Draft
**Input**: 비행기 충돌 감지와 점수 계산 시스템

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 충돌 감지 및 게임오버 (Priority: P1)

두 비행기가 서로 충돌하면 즉시 게임이 종료되고 게임오버 화면이 표시된다.

**Why this priority**: 게임의 핵심 규칙. 충돌 회피가 게임의 주요 도전 요소.

**Independent Test**: 두 비행기를 충돌시켜 게임오버가 발생하는지 확인

**Acceptance Scenarios**:

1. **Given** 두 비행기가 화면에 있을 때, **When** 서로 충돌하면, **Then** 즉시 게임이 멈추고 충돌 효과가 표시된다
2. **Given** 충돌이 발생했을 때, **When** 효과가 끝나면, **Then** 게임오버 화면이 표시된다
3. **Given** 비행기가 화면 경계 근처에 있을 때, **When** 다른 비행기와 충돌하면, **Then** 정상적으로 충돌이 감지된다

---

### User Story 2 - 착륙 성공 시 점수 획득 (Priority: P2)

비행기가 성공적으로 활주로에 착륙하면 점수를 획득하고, 화면에 점수가 표시된다.

**Why this priority**: 플레이어 동기 부여 및 게임 목표 제공

**Independent Test**: 비행기를 착륙시켜 점수가 증가하는지 확인

**Acceptance Scenarios**:

1. **Given** 비행기가 활주로에 도달했을 때, **When** 착륙이 완료되면, **Then** 해당 비행기 종류에 맞는 점수가 추가된다
2. **Given** 점수가 추가될 때, **When** 화면을 보면, **Then** 현재 점수가 즉시 업데이트되어 표시된다
3. **Given** 대형기가 착륙했을 때, **When** 점수가 계산되면, **Then** 소형기보다 높은 점수가 부여된다

---

### User Story 3 - 콤보 보너스 (Priority: P3)

연속으로 비행기를 착륙시키면 콤보 보너스 점수를 획득한다.

**Why this priority**: 게임의 재미 요소 및 숙련도 보상

**Independent Test**: 연속 착륙 시 콤보 카운터가 증가하고 보너스 점수가 적용되는지 확인

**Acceptance Scenarios**:

1. **Given** 비행기가 착륙했을 때, **When** 이전 착륙 후 일정 시간 내라면, **Then** 콤보 카운터가 증가한다
2. **Given** 콤보가 활성화된 상태에서, **When** 비행기가 착륙하면, **Then** 기본 점수 × 콤보 배수의 점수를 획득한다
3. **Given** 콤보가 진행 중일 때, **When** 일정 시간 동안 착륙이 없으면, **Then** 콤보가 리셋된다

---

### User Story 4 - 최고 점수 저장 (Priority: P4)

게임이 끝나면 최고 점수가 저장되고, 플레이어는 자신의 기록을 확인할 수 있다.

**Why this priority**: 재플레이 동기 부여

**Independent Test**: 높은 점수로 게임을 끝내고 다음 게임에서 최고 점수가 유지되는지 확인

**Acceptance Scenarios**:

1. **Given** 게임이 종료되었을 때, **When** 현재 점수가 최고 점수보다 높으면, **Then** 새로운 최고 점수로 저장된다
2. **Given** 새로운 최고 점수가 기록되었을 때, **When** 게임을 다시 시작하면, **Then** 저장된 최고 점수가 표시된다
3. **Given** 랭킹 화면에서, **When** 확인하면, **Then** 상위 5개의 점수 기록이 표시된다

---

### Edge Cases

- 두 비행기가 정확히 같은 프레임에 동일 지점에 도달하면 어떻게 되는가?
- 비행기가 착륙하는 순간 다른 비행기와 충돌하면 어떻게 처리하는가?
- 콤보 도중 게임오버가 되면 점수는 어떻게 계산되는가?
- 브라우저를 닫았다가 다시 열면 최고 점수가 유지되는가?

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 시스템은 매 프레임마다 모든 비행기 쌍의 충돌을 검사해야 한다
- **FR-002**: 두 비행기가 충돌하면 즉시 게임을 멈추고 게임오버 상태로 전환해야 한다
- **FR-003**: 비행기 착륙 시 종류에 따른 점수를 부여해야 한다
- **FR-004**: 연속 착륙 시 콤보 배수를 적용한 점수를 계산해야 한다
- **FR-005**: 현재 점수와 최고 점수를 화면에 표시해야 한다
- **FR-006**: 최고 점수는 브라우저 저장소에 영구 저장해야 한다
- **FR-007**: 상위 5개의 점수 기록을 저장하고 표시해야 한다
- **FR-008**: 충돌 감지는 성능에 영향을 주지 않도록 최적화되어야 한다

### Key Entities

- **Score**: 현재 점수 정보 (값, 콤보 카운터, 콤보 타이머)
- **HighScore**: 최고 점수 기록 (점수, 날짜)
- **ScoreConfig**: 점수 설정 (비행기 종류별 점수, 콤보 배수, 콤보 유지 시간)
- **CollisionResult**: 충돌 검사 결과 (충돌 여부, 충돌 위치, 관련 비행기)

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 충돌 발생 시 0.1초 이내에 게임오버 화면으로 전환된다
- **SC-002**: 50대의 비행기가 있을 때도 충돌 감지로 인한 프레임 저하가 없다
- **SC-003**: 착륙 성공 시 0.05초 이내에 점수가 화면에 업데이트된다
- **SC-004**: 콤보 시스템이 직관적으로 이해되어 플레이어가 의도적으로 콤보를 쌓을 수 있다
- **SC-005**: 최고 점수가 브라우저를 닫았다 열어도 100% 유지된다

## Assumptions

- 비행기 종류별 기본 점수: 소형기 10점, 대형기 30점, 헬기 20점
- 콤보 배수: 2연속 1.5배, 3연속 2배, 4연속 이상 2.5배
- 콤보 유지 시간: 5초 (마지막 착륙 후)
- 충돌 판정: 두 비행기 중심 간 거리가 히트박스 반경의 합보다 작으면 충돌
- 최대 저장 기록 수: 5개
